Пункт 1: «Концепция тренера (поведение vs план)»
Цель — чётко разделить: что относится к тренеру, а что — к плану пользователя.
Подзадачи
1) Определить границу ответственности
Тренер отвечает за тон, стиль, мотивацию, правила общения.
План отвечает за содержание задач, темп, сложность, сроки.
2) Задать приоритеты в конфликте
Если пользователь хочет лёгкий план + жёсткий тренер → тренер строгий, план лёгкий.
Если пользователь хочет сложный план + мягкий тренер → тренер мягкий, план сложный.
То есть план = выбор пользователя, тренер = стиль коммуникации.
3) Определить точки влияния тренера
Где тренер может рекомендовать изменения, но не навязывать.
Например:
“План слишком лёгкий, хочешь ускориться?”
“Слишком тяжело? Давай снизим темп.”
4) Зафиксировать модель данных
В данных должна быть пара тренер + план как независимые сущности.
Это защищает от смешивания и делает систему гибкой.
5) Сформулировать правило для промпта
В промпте всегда явно указывать две части:
“План: вот требования пользователя”
“Тон: вот стиль тренера”

Решение:
Пункт 1 - границы ответственности (MVP)
Главное разделение:
План задаёт пользователь (сроки, сложность, нагрузка, окна времени).
Тренер задаёт стиль общения и рекомендации, но не ломает ограничения пользователя.
Сценарии поведения (MVP):
1) Недостаточно данных → тренер достраивает план и явно помечает допущения.
2) Данные есть, но не подходят стилю тренера → тренер предлагает улучшения, не навязывает.
3) План невозможен → тренер прямо говорит и предлагает альтернативы.
4) Всё хорошо (ok) → тренер подтверждает корректность плана и продолжает.
Ключевое правило:
Тренер не нарушает пользовательские ограничения, только советует.
Структурирование входа (для оценки выполнимости):
Цель, уровень (если есть), срок.
Доступные часы/дни, временные окна, исключения (праздники).
Оценка “невозможно/рискованно” через сопоставление доступных часов и сложности цели.
Обработка “не цель” и отсутствие уровня:
Если уровня нет → считать базовым или уточнить у пользователя.
Если ввод не цель (“небо голубое”) → вежливо попросить сформулировать цель.
Post‑MVP:
Режим “risk/warn” с предупреждением о высокой вероятности срыва.

Пункт 2 — Конфликты и приоритеты (MVP)
Контекст:
Иногда требования пользователя к плану и стиль тренера конфликтуют. Например, пользователь хочет лёгкий план, а тренер выбран жёсткий. Важно заранее договориться, как система ведёт себя в таких случаях.
Что считается конфликтом
Конфликт — это ситуация, когда стиль тренера подразумевает один подход, а план пользователя требует другого.
Тренер не имеет права ломать план пользователя, но может рекомендовать изменения.
Основные типы конфликтов
1) Лёгкий план + жёсткий тренер
Пользователь хочет мягкий режим, но тренер строгий.
2) Сложный план + мягкий тренер
План интенсивный, тренер мягкий.
3) Ограничения против цели
Пользователь задаёт сроки/нагрузку, которые противоречат достижению цели.
4) Внутренние противоречия во вводе
Пользователь сам себе противоречит (например, время учёбы указано в двух разных вариантах).
Принятые решения (MVP)
План пользователя важнее стиля тренера.
Тренер никогда не меняет план без согласия.
Тренер может рекомендовать улучшения, но только предложением.
Если план невозможен, тренер прямо говорит об этом и предлагает варианты.
Если данные противоречивы, тренер просит уточнение и не строит план.
Примеры ответов (по одному, чтобы показать стиль)
Мягкий тренер:
“План выглядит интенсивным, но если тебе так комфортно — оставим. Если станет тяжело, можно снизить темп.”
Нормальный тренер:
“План выполнимый, но напряжённый. Можем либо оставить как есть, либо немного увеличить срок — решай.”
Жёсткий тренер:
“План слабый. Можно оставить, но результата будет меньше. Хочешь усилить или остаёмся?”

Пункт 3 — Точки влияния тренера (MVP)
Контекст:
Здесь фиксируем, где тренер имеет право влиять на процесс, не нарушая главного правила: план задаёт пользователь.
Принципы (MVP)
Тренер может рекомендовать изменения, но не имеет права менять план без согласия пользователя.
Стиль влияет на тон/частоту, а на автоматические действия — только при отдельном согласии пользователя..
Любые изменения плана требуют явного подтверждения.
“Власть” тренера по стилям
Лёгкий — мягкие советы, редкие напоминания.
Нормальный — советы + предупреждения при срывах.
Жёсткий — строгий тон, чаще пишет, может предлагать усилить план, но не менять без подтверждения.
Реакция на невыполнение (принцип)
Тренер всегда реагирует, но строго в рамках своего стиля:
мягкий — поддержка и мягкое возвращение к плану
нормальный — предупреждение и уточнение причин
жёсткий — строгий тон и требование вернуться к плану
Важно: реакция ≠ автоматическое изменение плана.



Пункт 4 — Модель данных: тренер и план как независимые сущности (MVP)
Контекст:
План (Goal/Milestones/Tasks) уже существует и хранится отдельно.
Тренер — это отдельная сущность, которая влияет на стиль общения, но не является частью плана.
Нужно зафиксировать независимость, чтобы тренера можно было менять без пересоздания плана.
Принятые решения (MVP)
1) План и тренер — независимы.
Тренер не “вшит” в план. Меняем тренера — план остаётся.
2) Ограничения плана храним как JSON в Goal.
Это гибко и позволяет добавлять новые ограничения без миграций.
3) Тренер выбирается пользователем и хранится в Goal.
В Goal добавляем trainer_id, trainer_gender.
4) Тренер по умолчанию хранится в User.
Добавляем default_trainer_id, default_trainer_gender.
5) Связь тренера с ассетами делаем через вариант пола.
TrainerProfile → TrainerVariant → TrainerAsset.
Ассеты привязаны к полу, поэтому напрямую к профилю не цепляем.
6) История планов в MVP — только “текущий” и “предыдущий”.
В milestones (и tasks) добавляем флаг версии (current/previous).
Новый план делает текущие шаги “previous”, старые previous удаляются.
Поведение при смене тренера (MVP)
План остаётся неизменным.
Новый тренер сразу начинает общение в своём стиле.
Любые изменения плана — только после подтверждения пользователя.
Предварительный JSON для “ограничений плана”
Важно: это предварительная структура, требует проверки при внедрении.
{
  "hours_per_day": 5,
  "days_per_week": 5,
  "time_window": { "start": "12:00", "end": "17:00" },
  "exclude_holidays": true,
  "workdays_only": true,
  "deadline": "2025-03-01",
  "plan_intensity": "medium",
  "plan_flexibility": "strict"
}

Пункт 5 — Правило для промпта (MVP)
Контекст:
Текущий промпт не разделяет требования пользователя к плану и стиль тренера. Чтобы тренер мог быть “персоной”, а план — соответствовать требованиям пользователя, нужно в промпте явно разделить две части.
Принятые решения
В системном промпте всегда присутствуют два явных блока:
1) ПЛАН (требования пользователя)
2) ТОН ТРЕНЕРА (стиль общения)
Формулировка фиксирует: план формирует AI на основе требований пользователя, а тренер отвечает за стиль.
Тренер может предлагать изменения, но не меняет план без согласия пользователя.



Вариант 1 — Минимальный (MVP)
Цель: быстро привести остальные промпты к общей структуре, без полной переработки.
Что меняем
Добавляем в начало блоки ПЛАН и ТОН
Добавляем формулировку:
> “План формирует AI на основе требований пользователя…”
Оставляем остальную логику как есть
Где применять
build_system_prompt в основном чате
все дополнительные промпты в ai.py (если используются)
Вариант 2 — Расширенный (единый стиль)
Цель: единая логика тренера во всех точках общения.
Что меняем
Все промпты переводим на единый шаблон (тот, что в Update.md)
Везде подставляем:
{trainer_*}
{plan_*}
Добавляем общие правила:
стиль тренера
стоп‑слова
разделение “ПЛАН vs ТОН”
запрет на автоправки без согласия
Где применять
build_system_prompt
/api/ai/chat
промпты приветствий (generate_greeting)
промпты follow‑up сообщений (после подтверждений)
Пункт 1: «Концепция тренера (поведение vs план)»
Цель — чётко разделить: что относится к тренеру, а что — к плану пользователя.
Подзадачи
1) Определить границу ответственности
Тренер отвечает за тон, стиль, мотивацию, правила общения.
План отвечает за содержание задач, темп, сложность, сроки.
2) Задать приоритеты в конфликте
Если пользователь хочет лёгкий план + жёсткий тренер → тренер строгий, план лёгкий.
Если пользователь хочет сложный план + мягкий тренер → тренер мягкий, план сложный.
То есть план = выбор пользователя, тренер = стиль коммуникации.
3) Определить точки влияния тренера
Где тренер может рекомендовать изменения, но не навязывать.
Например:
“План слишком лёгкий, хочешь ускориться?”
“Слишком тяжело? Давай снизим темп.”
4) Зафиксировать модель данных
В данных должна быть пара тренер + план как независимые сущности.
Это защищает от смешивания и делает систему гибкой.
5) Сформулировать правило для промпта
В промпте всегда явно указывать две части:
“План: вот требования пользователя”
“Тон: вот стиль тренера”

Решение:
Пункт 1 - границы ответственности (MVP)
Главное разделение:
План задаёт пользователь (сроки, сложность, нагрузка, окна времени).
Тренер задаёт стиль общения и рекомендации, но не ломает ограничения пользователя.
Сценарии поведения (MVP):
1) Недостаточно данных → тренер достраивает план и явно помечает допущения.
2) Данные есть, но не подходят стилю тренера → тренер предлагает улучшения, не навязывает.
3) План невозможен → тренер прямо говорит и предлагает альтернативы.
4) Всё хорошо (ok) → тренер подтверждает корректность плана и продолжает.
Ключевое правило:
Тренер не нарушает пользовательские ограничения, только советует.
Структурирование входа (для оценки выполнимости):
Цель, уровень (если есть), срок.
Доступные часы/дни, временные окна, исключения (праздники).
Оценка “невозможно/рискованно” через сопоставление доступных часов и сложности цели.
Обработка “не цель” и отсутствие уровня:
Если уровня нет → считать базовым или уточнить у пользователя.
Если ввод не цель (“небо голубое”) → вежливо попросить сформулировать цель.
Post‑MVP:
Режим “risk/warn” с предупреждением о высокой вероятности срыва.

Пункт 2 — Конфликты и приоритеты (MVP)
Контекст:
Иногда требования пользователя к плану и стиль тренера конфликтуют. Например, пользователь хочет лёгкий план, а тренер выбран жёсткий. Важно заранее договориться, как система ведёт себя в таких случаях.
Что считается конфликтом
Конфликт — это ситуация, когда стиль тренера подразумевает один подход, а план пользователя требует другого.
Тренер не имеет права ломать план пользователя, но может рекомендовать изменения.
Основные типы конфликтов
1) Лёгкий план + жёсткий тренер
Пользователь хочет мягкий режим, но тренер строгий.
2) Сложный план + мягкий тренер
План интенсивный, тренер мягкий.
3) Ограничения против цели
Пользователь задаёт сроки/нагрузку, которые противоречат достижению цели.
4) Внутренние противоречия во вводе
Пользователь сам себе противоречит (например, время учёбы указано в двух разных вариантах).
Принятые решения (MVP)
План пользователя важнее стиля тренера.
Тренер никогда не меняет план без согласия.
Тренер может рекомендовать улучшения, но только предложением.
Если план невозможен, тренер прямо говорит об этом и предлагает варианты.
Если данные противоречивы, тренер просит уточнение и не строит план.
Примеры ответов (по одному, чтобы показать стиль)
Мягкий тренер:
“План выглядит интенсивным, но если тебе так комфортно — оставим. Если станет тяжело, можно снизить темп.”
Нормальный тренер:
“План выполнимый, но напряжённый. Можем либо оставить как есть, либо немного увеличить срок — решай.”
Жёсткий тренер:
“План слабый. Можно оставить, но результата будет меньше. Хочешь усилить или остаёмся?”

Пункт 3 — Точки влияния тренера (MVP)
Контекст:
Здесь фиксируем, где тренер имеет право влиять на процесс, не нарушая главного правила: план задаёт пользователь.
Принципы (MVP)
Тренер может рекомендовать изменения, но не имеет права менять план без согласия пользователя.
Стиль влияет на тон/частоту, а на автоматические действия — только при отдельном согласии пользователя..
Любые изменения плана требуют явного подтверждения.
“Власть” тренера по стилям
Лёгкий — мягкие советы, редкие напоминания.
Нормальный — советы + предупреждения при срывах.
Жёсткий — строгий тон, чаще пишет, может предлагать усилить план, но не менять без подтверждения.
Реакция на невыполнение (принцип)
Тренер всегда реагирует, но строго в рамках своего стиля:
мягкий — поддержка и мягкое возвращение к плану
нормальный — предупреждение и уточнение причин
жёсткий — строгий тон и требование вернуться к плану
Важно: реакция ≠ автоматическое изменение плана.



Пункт 4 — Модель данных: тренер и план как независимые сущности (MVP)
Контекст:
План (Goal/Milestones/Tasks) уже существует и хранится отдельно.
Тренер — это отдельная сущность, которая влияет на стиль общения, но не является частью плана.
Нужно зафиксировать независимость, чтобы тренера можно было менять без пересоздания плана.
Принятые решения (MVP)
1) План и тренер — независимы.
Тренер не “вшит” в план. Меняем тренера — план остаётся.
2) Ограничения плана храним как JSON в Goal.
Это гибко и позволяет добавлять новые ограничения без миграций.
3) Тренер выбирается пользователем и хранится в Goal.
В Goal добавляем trainer_id, trainer_gender.
4) Тренер по умолчанию хранится в User.
Добавляем default_trainer_id, default_trainer_gender.
5) Связь тренера с ассетами делаем через вариант пола.
TrainerProfile → TrainerVariant → TrainerAsset.
Ассеты привязаны к полу, поэтому напрямую к профилю не цепляем.
6) История планов в MVP — только “текущий” и “предыдущий”.
В milestones (и tasks) добавляем флаг версии (current/previous).
Новый план делает текущие шаги “previous”, старые previous удаляются.
Поведение при смене тренера (MVP)
План остаётся неизменным.
Новый тренер сразу начинает общение в своём стиле.
Любые изменения плана — только после подтверждения пользователя.
Предварительный JSON для “ограничений плана”
Важно: это предварительная структура, требует проверки при внедрении.
{
  "hours_per_day": 5,
  "days_per_week": 5,
  "time_window": { "start": "12:00", "end": "17:00" },
  "exclude_holidays": true,
  "workdays_only": true,
  "deadline": "2025-03-01",
  "plan_intensity": "medium",
  "plan_flexibility": "strict"
}

Пункт 5 — Правило для промпта (MVP)
Контекст:
Текущий промпт не разделяет требования пользователя к плану и стиль тренера. Чтобы тренер мог быть “персоной”, а план — соответствовать требованиям пользователя, нужно в промпте явно разделить две части.
Принятые решения
В системном промпте всегда присутствуют два явных блока:
1) ПЛАН (требования пользователя)
2) ТОН ТРЕНЕРА (стиль общения)
Формулировка фиксирует: план формирует AI на основе требований пользователя, а тренер отвечает за стиль.
Тренер может предлагать изменения, но не меняет план без согласия пользователя.



Вариант 1 — Минимальный (MVP)
Цель: быстро привести остальные промпты к общей структуре, без полной переработки.
Что меняем
Добавляем в начало блоки ПЛАН и ТОН
Добавляем формулировку:
> “План формирует AI на основе требований пользователя…”
Оставляем остальную логику как есть
Где применять
build_system_prompt в основном чате
все дополнительные промпты в ai.py (если используются)
Вариант 2 — Расширенный (единый стиль)
Цель: единая логика тренера во всех точках общения.
Что меняем
Все промпты переводим на единый шаблон (тот, что в Update.md)
Везде подставляем:
{trainer_*}
{plan_*}
Добавляем общие правила:
стиль тренера
стоп‑слова
разделение “ПЛАН vs ТОН”
запрет на автоправки без согласия
Где применять
build_system_prompt
/api/ai/chat
промпты приветствий (generate_greeting)
промпты follow‑up сообщений (после подтверждений)